apiVersion: v1
kind: ConfigMap
metadata:
  name: casc-jenkins-config
  namespace: jenkins
data:
  casc-jenkins.yaml: |
    jenkins:
      systemMessage: "Jenkins configured automatically by Jenkins Configuration as Code plugin"

      securityRealm:
        local:
          allowsSignup: false
          users:
            - id: devops
              password: "${DEVOPS_PASSWORD}"
            - id: developer
              password: "${DEVELOPER_PASSWORD}"
            - id: viewer
              password: "${VIEWER_PASSWORD}"
            - id: test
              password: "${TEST_PASSWORD}"

      authorizationStrategy:
        projectMatrix:
          entries:
            - user:
                name: admin
                permissions:
                  - Overall/Administer
            - user:
                name: developer
                permissions:
                  - Overall/Read
                  - Job/Build
            - user:
                name: viewer
                permissions:
                  - Overall/Read
            - user:
                name: test
                permissions:
                  - Overall/Read

      clouds:
        - kubernetes:
            name: "kubernetes"
            namespace: "jenkins"
            serverUrl: "https://kubernetes.default.svc.cluster.local"
            jenkinsUrl: "http://jenkins:8080"
            webSocket: true
            containerCapStr: "2"
            templates:
              - name: "go-agent"
                label: "go"
                nodeSelector: "project=default,agent=true"
                serviceAccount: "jenkins-agent"
                idleMinutes: 5
                containers:
                  - name: "jnlp"
                    image: "jenkins/inbound-agent:latest"
                    args: "${computer.jnlpConnSecret} ${computer.name}"
                    resourceRequestCpu: "100m"
                    resourceRequestMemory: "256Mi"
                  - name: "go"
                    image: "golang:1.22"
                    ttyEnabled: true
                    command: "cat"
                    resourceRequestCpu: "500m"
                    resourceRequestMemory: "512Mi"
                    resourceLimitCpu: "1"
                    resourceLimitMemory: "2Gi"

              - name: "react-agent"
                label: "react"
                nodeSelector: "project=default,agent=true"
                serviceAccount: "jenkins-agent"
                idleMinutes: 5
                containers:
                  - name: "jnlp"
                    image: "jenkins/inbound-agent:latest"
                    args: "${computer.jnlpConnSecret} ${computer.name}"
                    resourceRequestCpu: "100m"
                    resourceRequestMemory: "256Mi"
                  - name: "node"
                    image: "node:20-alpine"
                    ttyEnabled: true
                    command: "cat"
                    resourceRequestCpu: "500m"
                    resourceRequestMemory: "512Mi"
                    resourceLimitCpu: "1"
                    resourceLimitMemory: "2Gi"
    
    unclassified:
        globalLibraries:
          libraries:
            - name: "shared-lib"
              defaultVersion: "master"
              implicit: false
              retriever:
                modernSCM:
                  scm:
                    git:
                      remote: "https://bitbucket.org/it-aryanoble/shared-library-jenkins.git"
                      credentialsId: "bitbucket-credentials"